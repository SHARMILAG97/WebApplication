package com.revature.WatrerPlant.Service;

import java.util.Scanner;

import com.revature.WaterPlant.dao.OrderDao;
import com.revature.WaterPlant.dao.ReserveDao;
import com.revature.WaterPlant.dao.ReserveInterface;
import com.revature.WaterPlant.dao.StockDao;
import com.revature.WaterPlant.dao.StockInterface;
import com.revature.WaterPlant.exception.DBException;
import com.revature.WaterPlant.model.User;

public class OrderReserve {

	public static void ReserveOrder(User u)  {
		
		System.out.println("Enter Reserve id");
		boolean bl = true;
		String S=null;
		while(bl) {
		try {
			S = sc.next();
			choice = Integer.parseInt(S);
			bl = false;
			break;
		} catch (Exception e) {
			System.out.println(".......Invalid Option.....\n\nPlease Enter an Integer value");
			bl = true;
		}
		}
		Scanner sc = new Scanner(System.in);
		int Rid = sc.nextInt();
		boolean b = true;
		User u1;
		int ordercan =0;
		try {
			ReserveInterface dao = new ReserveDao();
			u1 = dao.findByReserveId(Rid);
			while(u1==null)
			{
				System.out.println("Invalid Reserve Id");
			}
			while(b)
				{
				int reservecan=u1.getReservecan();
				System.out.println("Your Reserved Cans: "+reservecan);
			System.out.println("Enter No of Cans to Order");
			String S = null;
			boolean bl = true;
			while(bl) {
			try {
				S = sc.next();
				ordercan = Integer.parseInt(S);
				bl = false;
				break;
			} catch (Exception e) {
				System.out.println(".......Invalid Option.....\n\nPlease Enter an Integer value");
				bl = true;
			}
			}
			
			if(ordercan <= reservecan) {
				
				ReserveDao.updateReserve(ordercan, Rid);
				OrderDao.updateOrder(u,ordercan, Rid);
				StockInterface Sdao = new StockDao();
				User stock = Sdao.getStock();
				int updatecan=Sdao.findOne();
				int Stockordercan=stock.getOrdercan();
				int Stockreservecan = stock.getReservecan();
				int addcan=reservecan-ordercan;
				updatecan+=addcan;
				Stockordercan+=ordercan;
				Stockreservecan-=ordercan;
				Sdao.updateOrderReserve(updatecan,Stockordercan,Stockreservecan);
				System.out.println("Ordered the Reserved Cans Sucessfully");
				b= false;
			}
			else
			{
				System.out.println("Enter cans below :"+reservecan);
			}
				}
			
			
			
		
		} catch (DBException e) {
			
			e.printStackTrace();
		}
		

	}}
